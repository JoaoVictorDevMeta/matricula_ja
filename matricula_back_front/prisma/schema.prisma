// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Usuario {
  id_usuario Int      @id @default(autoincrement())
  nome       String?  
  perfil_id  Int?
  perfil     Perfil?  @relation(fields: [perfil_id], references: [id_perfil])

  AlertaUser AlertaUser[]
}

model AlertaUser {
  id_alerta_user Int      @id @default(autoincrement())
  data_envio     DateTime @default(now())
  usuario_id     Int
  alerta_id      Int

  usuario        Usuario @relation(fields: [usuario_id], references: [id_usuario])
  alerta         Alerta  @relation(fields: [alerta_id], references: [id_alerta])
}

model Alerta {
  id_alerta  Int      @id @default(autoincrement())
  titulo     String   
  descricao  String   

  AlertaUser AlertaUser[]
}

model Perfil {
  id_perfil Int      @id @default(autoincrement())
  usuarios  Usuario[]
}

model Escola {
  id_escola   Int            @id @default(autoincrement())
  nome_escola String
  turmas      TurmaEscola[]  // One Escola has many TurmaEscola
}

model TurmaEscola {
  id_turma_escola       Int            @id @default(autoincrement())
  id_escola_fk          Int            // Foreign key to Escola
  ano                   Int            // Year
  qtde_vagas_ofertadas  Int
  qtde_vagas_disponiveis Int

  escola                Escola         @relation(fields: [id_escola_fk], references: [id_escola], onDelete: Cascade)
  estudantes            EstudantesTurmasEscola[]  // One TurmaEscola has many EstudantesTurmasEscola

  @@unique([id_escola_fk, ano]) 
}

model EstudantesTurmasEscola {
  id_estudante_turma    Int            @id @default(autoincrement())
  id_estudante_fk       Int            // Foreign key to the Estudante (assuming you have a separate Estudante model)
  id_turma_escola_fk    Int            // Foreign key to TurmaEscola
  ano Int
  id_situacao_fk        Int?
  datahora_prematricula String?
  datahora_matricula    String?

  turma                 TurmaEscola    @relation(fields: [id_turma_escola_fk], references: [id_turma_escola], onDelete: Cascade)
  @@unique([id_estudante_fk, id_turma_escola_fk, ano])
}